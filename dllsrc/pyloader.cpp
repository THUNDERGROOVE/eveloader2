//
// Created by Nick on 10/20/2021.
//

#include "pyloader.h"

#include "pydefs.h"

#include "psapi.h"

#include "eveloader_util.hpp"

static const char *compile_strings_pattern = "\x55\x8B\xEC\x53\x8B\x5D\x14\x56\xE8\x8E\x75\xE5\xFF\x8B\xF0\x85\xF6\x75\x2E\xEB\x51\x85\xDB\x74\x18\xF7\x03";
#define compile_strings_pattern_size 27

void load_py_symbols() {
    HMODULE py = GetModuleHandleA("python27");
    if (py == nullptr) {
        exit(-100);
    }

    // CCP omits this needed symbol..
    {
        MODULEINFO modinfo;
        memset(&modinfo, 0, sizeof(modinfo));
        if (GetModuleInformation(GetCurrentProcess(), py, &modinfo, sizeof(modinfo)) == 0) {
            exit(-101);
        }

        char *start = (char *)modinfo.lpBaseOfDll;
        int size = modinfo.SizeOfImage;

        void *symbol = memmem(start, size, compile_strings_pattern, compile_strings_pattern_size);
        if (symbol == nullptr) {
            exit(-102);
        } else {
            EVEPy_CompileStringFlags = (_EVEPy_CompileStringFlags)symbol;
        }
    }

    LOADPY(PyObject_Cmp);
    LOADPY(PyCallable_Check);
    LOADPY(PyObject_Call);
    LOADPY(PyObject_CallObject);
    LOADPY(PyObject_CallFunction);
    LOADPY(PyObject_CallMethod);
    LOADPY(_PyObject_CallFunction_SizeT);
    LOADPY(_PyObject_CallMethod_SizeT);
    LOADPY(PyObject_CallFunctionObjArgs);
    LOADPY(PyObject_CallMethodObjArgs);
    LOADPY(PyObject_Type);
    LOADPY(PyObject_Size);
    LOADPY(PyObject_Length);
    LOADPY(_PyObject_LengthHint);
    LOADPY(PyObject_GetItem);
    LOADPY(PyObject_SetItem);
    LOADPY(PyObject_DelItemString);
    LOADPY(PyObject_DelItem);
    LOADPY(PyObject_AsCharBuffer);
    LOADPY(PyObject_CheckReadBuffer);
    LOADPY(PyObject_AsReadBuffer);
    LOADPY(PyObject_AsWriteBuffer);
    LOADPY(PyObject_GetBuffer);
    LOADPY(PyBuffer_GetPointer);
    LOADPY(PyBuffer_SizeFromFormat);
    LOADPY(PyBuffer_ToContiguous);
    LOADPY(PyBuffer_FromContiguous);
    LOADPY(PyObject_CopyData);
    LOADPY(PyBuffer_IsContiguous);
    LOADPY(PyBuffer_FillContiguousStrides);
    LOADPY(PyBuffer_FillInfo);
    LOADPY(PyBuffer_Release);
    LOADPY(PyObject_Format);
    LOADPY(PyObject_GetIter);
    LOADPY(PyIter_Next);
    LOADPY(PyNumber_Check);
    LOADPY(PyNumber_Add);
    LOADPY(PyNumber_Subtract);
    LOADPY(PyNumber_Multiply);
    LOADPY(PyNumber_Divide);
    LOADPY(PyNumber_FloorDivide);
    LOADPY(PyNumber_TrueDivide);
    LOADPY(PyNumber_Remainder);
    LOADPY(PyNumber_Divmod);
    LOADPY(PyNumber_Power);
    LOADPY(PyNumber_Negative);
    LOADPY(PyNumber_Positive);
    LOADPY(PyNumber_Absolute);
    LOADPY(PyNumber_Invert);
    LOADPY(PyNumber_Lshift);
    LOADPY(PyNumber_Rshift);
    LOADPY(PyNumber_And);
    LOADPY(PyNumber_Xor);
    LOADPY(PyNumber_Or);
    LOADPY(PyNumber_Index);
    LOADPY(PyNumber_AsSsize_t);
    LOADPY(_PyNumber_ConvertIntegralToInt);
    LOADPY(PyNumber_Int);
    LOADPY(PyNumber_Long);
    LOADPY(PyNumber_Float);
    LOADPY(PyNumber_InPlaceAdd);
    LOADPY(PyNumber_InPlaceSubtract);
    LOADPY(PyNumber_InPlaceMultiply);
    LOADPY(PyNumber_InPlaceDivide);
    LOADPY(PyNumber_InPlaceFloorDivide);
    LOADPY(PyNumber_InPlaceTrueDivide);
    LOADPY(PyNumber_InPlaceRemainder);
    LOADPY(PyNumber_InPlacePower);
    LOADPY(PyNumber_InPlaceLshift);
    LOADPY(PyNumber_InPlaceRshift);
    LOADPY(PyNumber_InPlaceAnd);
    LOADPY(PyNumber_InPlaceXor);
    LOADPY(PyNumber_InPlaceOr);
    LOADPY(PyNumber_ToBase);
    LOADPY(PySequence_Check);
    LOADPY(PySequence_Size);
    LOADPY(PySequence_Length);
    LOADPY(PySequence_Concat);
    LOADPY(PySequence_Repeat);
    LOADPY(PySequence_GetItem);
    LOADPY(PySequence_GetSlice);
    LOADPY(PySequence_SetItem);
    LOADPY(PySequence_DelItem);
    LOADPY(PySequence_SetSlice);
    LOADPY(PySequence_DelSlice);
    LOADPY(PySequence_Tuple);
    LOADPY(PySequence_List);
    LOADPY(PySequence_Fast);
    LOADPY(PySequence_Count);
    LOADPY(PySequence_Contains);
    LOADPY(_PySequence_IterSearch);
    LOADPY(PySequence_In);
    LOADPY(PySequence_Index);
    LOADPY(PySequence_InPlaceConcat);
    LOADPY(PySequence_InPlaceRepeat);
    LOADPY(PyMapping_Check);
    LOADPY(PyMapping_Size);
    LOADPY(PyMapping_Length);
    LOADPY(PyMapping_HasKeyString);
    LOADPY(PyMapping_HasKey);
    LOADPY(PyMapping_GetItemString);
    LOADPY(PyMapping_SetItemString);
    LOADPY(PyObject_IsInstance);
    LOADPY(PyObject_IsSubclass);
    LOADPY(_PyObject_RealIsInstance);
    LOADPY(_PyObject_RealIsSubclass);
    LOADPY(_Py_add_one_to_index_F);
    LOADPY(_Py_add_one_to_index_C);
    LOADPY(PyBool_FromLong);
    LOADPY(PyBuffer_FromObject);
    LOADPY(PyBuffer_FromReadWriteObject);
    LOADPY(PyBuffer_FromMemory);
    LOADPY(PyBuffer_FromReadWriteMemory);
    LOADPY(PyBuffer_New);
    LOADPY(PyByteArray_FromObject);
    LOADPY(PyByteArray_Concat);
    LOADPY(PyByteArray_FromStringAndSize);
    LOADPY(PyByteArray_Size);
    LOADPY(PyByteArray_AsString);
    LOADPY(PyByteArray_Resize);
    LOADPY(PyCell_New);
    LOADPY(PyCell_Get);
    LOADPY(PyCell_Set);
    LOADPY(PyEval_CallObjectWithKeywords);
    LOADPY(PyEval_CallFunction);
    LOADPY(PyEval_CallMethod);
    LOADPY(PyEval_SetProfile);
    LOADPY(PyEval_SetTrace);
    LOADPY(PyEval_GetBuiltins);
    LOADPY(PyEval_GetGlobals);
    LOADPY(PyEval_GetLocals);
    LOADPY(PyEval_GetRestricted);
    LOADPY(PyEval_MergeCompilerFlags);
    LOADPY(Py_FlushLine);
    LOADPY(Py_AddPendingCall);
    LOADPY(Py_MakePendingCalls);
    LOADPY(Py_SetRecursionLimit);
    LOADPY(Py_GetRecursionLimit);
    LOADPY(_Py_CheckRecursiveCall);
    LOADPY(PyEval_GetCallStats);
    LOADPY(PyEval_EvalFrame);
    LOADPY(PyEval_EvalFrameEx);
    LOADPY(PyEval_EvalFrame_slp);
    LOADPY(PyEval_EvalFrameEx_slp);
    LOADPY(PyEval_SaveThread);
    LOADPY(PyEval_RestoreThread);
    LOADPY(PyEval_InitThreads);
    LOADPY(PyEval_AcquireLock);
    LOADPY(PyEval_ReleaseLock);
    LOADPY(PyEval_AcquireThread);
    LOADPY(PyEval_ReleaseThread);
    LOADPY(PyEval_ReInitThreads);
    LOADPY(_PyEval_SliceIndex);
    LOADPY(PyClass_New);
    LOADPY(PyInstance_New);
    LOADPY(PyInstance_NewRaw);
    LOADPY(PyMethod_New);
    LOADPY(PyMethod_Function);
    LOADPY(PyMethod_Self);
    LOADPY(PyMethod_Class);
    LOADPY(_PyInstance_Lookup);
    LOADPY(PyClass_IsSubclass);
    LOADPY(PyMethod_ClearFreeList);
    LOADPY(PyCObject_AsVoidPtr);
    LOADPY(PyCObject_GetDesc);
    LOADPY(PyCObject_Import);
    LOADPY(PyCObject_SetVoidPtr);
    LOADPY(PyCode_New);
    LOADPY(PyCode_Addr2Line);
    LOADPY(_PyCode_CheckLineNumber);
    LOADPY(_PyCode_ConstantKey);
    LOADPY(PyCode_Optimize);
    LOADPY(PyCodec_RegisterError);
    LOADPY(PyCodec_LookupError);
    LOADPY(PyCodec_StrictErrors);
    LOADPY(PyCodec_IgnoreErrors);
    LOADPY(PyCodec_ReplaceErrors);
    LOADPY(PyCodec_XMLCharRefReplaceErrors);
    LOADPY(PyCodec_BackslashReplaceErrors);
    LOADPY(PyNode_Compile);
    LOADPY(PyAST_Compile);
    LOADPY(PyFuture_FromAST);
    LOADPY(PyComplex_FromCComplex);
    LOADPY(PyComplex_FromDoubles);
    LOADPY(PyComplex_RealAsDouble);
    LOADPY(PyComplex_ImagAsDouble);
    LOADPY(PyComplex_AsCComplex);
    LOADPY(_PyComplex_FormatAdvanced);
    LOADPY(PyDescr_NewMethod);
    LOADPY(PyDescr_NewClassMethod);
    LOADPY(PyDescr_NewMember);
    LOADPY(PyDescr_NewGetSet);
    LOADPY(PyDescr_NewWrapper);
    LOADPY(PyDictProxy_New);
    LOADPY(PyWrapper_New);
    LOADPY(PyDict_New);
    LOADPY(PyDict_GetItem);
    LOADPY(_PyDict_GetItemWithError);
    LOADPY(PyDict_SetItem);
    LOADPY(PyDict_DelItem);
    LOADPY(PyDict_Clear);
    LOADPY(PyDict_Next);
    LOADPY(_PyDict_Next);
    LOADPY(PyDict_Keys);
    LOADPY(PyDict_Values);
    LOADPY(PyDict_Items);
    LOADPY(PyDict_Size);
    LOADPY(PyDict_Copy);
    LOADPY(PyDict_Contains);
    LOADPY(_PyDict_Contains);
    LOADPY(_PyDict_NewPresized);
    LOADPY(_PyDict_MaybeUntrack);
    LOADPY(PyDict_Update);
    LOADPY(PyDict_Merge);
    LOADPY(PyDict_MergeFromSeq2);
    LOADPY(PyDict_GetItemString);
    LOADPY(PyDict_SetItemString);
    LOADPY(PyDict_DelItemString);
    LOADPY(_Py_dg_strtod);
    LOADPY(_Py_dg_dtoa);
    LOADPY(_Py_dg_freedtoa);
    LOADPY(PyEval_EvalCode);
    LOADPY(PyEval_EvalCodeEx);
    LOADPY(_PyEval_CallTracing);
    LOADPY(PyFile_FromString);
    LOADPY(PyFile_SetBufSize);
    LOADPY(PyFile_SetEncoding);
    LOADPY(PyFile_SetEncodingAndErrors);
    LOADPY(PyFile_FromFile);
    LOADPY(PyFile_AsFile);
    LOADPY(PyFile_IncUseCount);
    LOADPY(PyFile_DecUseCount);
    LOADPY(PyFile_Name);
    LOADPY(PyFile_GetLine);
    LOADPY(PyFile_WriteObject);
    LOADPY(PyFile_SoftSpace);
    LOADPY(PyFile_WriteString);
    LOADPY(PyObject_AsFileDescriptor);
    LOADPY(PyFloat_GetMax);
    LOADPY(PyFloat_GetMin);
    LOADPY(PyFloat_GetInfo);
    LOADPY(PyFloat_FromString);
    LOADPY(PyFloat_FromDouble);
    LOADPY(PyFloat_AsDouble);
    LOADPY(PyFloat_AsReprString);
    LOADPY(PyFloat_AsString);
    LOADPY(_PyFloat_Pack4);
    LOADPY(_PyFloat_Pack8);
    LOADPY(_PyFloat_Digits);
    LOADPY(_PyFloat_DigitsInit);
    LOADPY(_PyFloat_Unpack4);
    LOADPY(_PyFloat_Unpack8);
    LOADPY(PyFloat_ClearFreeList);
    LOADPY(_PyFloat_FormatAdvanced);
    LOADPY(_Py_double_round);
    LOADPY(PyFrame_New);
    LOADPY(PyFrame_BlockSetup);
    LOADPY(PyFrame_BlockPop);
    LOADPY(PyFrame_ExtendStack);
    LOADPY(PyFrame_LocalsToFast);
    LOADPY(PyFrame_FastToLocals);
    LOADPY(PyFrame_ClearFreeList);
    LOADPY(PyFrame_GetLineNumber);
    LOADPY(PyFunction_New);
    LOADPY(PyFunction_GetCode);
    LOADPY(PyFunction_GetGlobals);
    LOADPY(PyFunction_GetModule);
    LOADPY(PyFunction_GetDefaults);
    LOADPY(PyFunction_SetDefaults);
    LOADPY(PyFunction_GetClosure);
    LOADPY(PyFunction_SetClosure);
    LOADPY(PyClassMethod_New);
    LOADPY(PyStaticMethod_New);
    LOADPY(PyGen_New);
    LOADPY(PyGen_NeedsFinalizing);
    LOADPY(PyImport_GetMagicNumber);
    LOADPY(PyImport_ExecCodeModule);
    LOADPY(PyImport_ExecCodeModuleEx);
    LOADPY(PyImport_GetModuleDict);
    LOADPY(PyImport_AddModule);
    LOADPY(PyImport_ImportModule);
    LOADPY(PyImport_ImportModuleNoBlock);
    LOADPY(PyImport_ImportModuleLevel);
    LOADPY(PyImport_GetImporter);
    LOADPY(PyImport_Import);
    LOADPY(PyImport_ReloadModule);
    LOADPY(PyImport_Cleanup);
    LOADPY(PyImport_ImportFrozenModule);
    LOADPY(_PyImport_AcquireLock);
    LOADPY(_PyImport_ReleaseLock);
    LOADPY(_PyImport_IsScript);
    LOADPY(_PyImport_ReInitLock);
    LOADPY(_PyImport_FindExtension);
    LOADPY(_PyImport_FixupExtension);
    LOADPY(PyInt_FromString);
    LOADPY(PyInt_FromUnicode);
    LOADPY(PyInt_FromLong);
    LOADPY(PyInt_FromSize_t);
    LOADPY(PyInt_FromSsize_t);
    LOADPY(PyInt_AsLong);
    LOADPY(PyInt_AsSsize_t);
    LOADPY(_PyInt_AsInt);
    LOADPY(PyInt_GetMax);
    LOADPY(PyOS_strtol);
    LOADPY(PyInt_ClearFreeList);
    LOADPY(_PyInt_Format);
    LOADPY(_PyInt_FormatAdvanced);
    LOADPY(PyOS_InterruptOccurred);
    LOADPY(PyOS_InitInterrupts);
    LOADPY(PyOS_AfterFork);
    LOADPY(PySeqIter_New);
    LOADPY(PyCallIter_New);
    LOADPY(PyList_New);
    LOADPY(PyList_Size);
    LOADPY(PyList_GetItem);
    LOADPY(PyList_SetItem);
    LOADPY(PyList_Insert);
    LOADPY(PyList_Append);
    LOADPY(PyList_GetSlice);
    LOADPY(PyList_SetSlice);
    LOADPY(PyList_Sort);
    LOADPY(PyList_Reverse);
    LOADPY(PyList_AsTuple);
    LOADPY(_PyList_Extend);
    LOADPY(_PyLong_New);
    LOADPY(_PyLong_Copy);
    LOADPY(PyLong_FromLong);
    LOADPY(PyLong_FromUnsignedLong);
    LOADPY(PyLong_FromDouble);
    LOADPY(PyLong_FromSize_t);
    LOADPY(PyLong_FromSsize_t);
    LOADPY(PyLong_AsLong);
    LOADPY(PyLong_AsLongAndOverflow);
    LOADPY(PyLong_AsSsize_t);
    LOADPY(_PyLong_AsInt);
    LOADPY(PyLong_GetInfo);
    LOADPY(_PyLong_Frexp);
    LOADPY(PyLong_AsDouble);
    LOADPY(PyLong_FromVoidPtr);
    LOADPY(PyLong_AsVoidPtr);
    LOADPY(PyLong_FromLongLong);
    LOADPY(PyLong_FromUnsignedLongLong);
    LOADPY(PyLong_AsLongLong);
    LOADPY(PyLong_AsLongLongAndOverflow);
    LOADPY(PyLong_FromString);
    LOADPY(PyLong_FromUnicode);
    LOADPY(_PyLong_Sign);
    LOADPY(_PyLong_NumBits);
    LOADPY(_PyLong_FromByteArray);
    LOADPY(_PyLong_AsByteArray);
    LOADPY(_PyLong_Format);
    LOADPY(_PyLong_FormatAdvanced);
    LOADPY(PyMarshal_WriteLongToFile);
    LOADPY(PyMarshal_WriteObjectToFile);
    LOADPY(PyMarshal_WriteObjectToString);
    LOADPY(PyMarshal_ReadLongFromFile);
    LOADPY(PyMarshal_ReadShortFromFile);
    LOADPY(PyMarshal_ReadObjectFromFile);
    LOADPY(PyMarshal_ReadLastObjectFromFile);
    LOADPY(PyMarshal_ReadObjectFromString);
    LOADPY(PyCFunction_GetFunction);
    LOADPY(PyCFunction_GetSelf);
    LOADPY(PyCFunction_GetFlags);
    LOADPY(PyCFunction_Call);
    LOADPY(Py_FindMethod);
    LOADPY(PyCFunction_ClearFreeList);
    LOADPY(_Py_VaBuildValue_SizeT);
    LOADPY(PyArg_Parse);
    LOADPY(PyArg_ParseTuple);
    LOADPY(PyArg_ParseTupleAndKeywords);
    LOADPY(PyArg_UnpackTuple);
    LOADPY(Py_BuildValue);
    LOADPY(_Py_BuildValue_SizeT);
    LOADPY(_PyArg_NoKeywords);
    LOADPY(PyArg_VaParse);
    LOADPY(PyArg_VaParseTupleAndKeywords);
    LOADPY(Py_VaBuildValue);
    LOADPY(PyModule_AddObject);
    LOADPY(PyModule_AddIntConstant);
    LOADPY(PyModule_AddStringConstant);
    LOADPY(Py_InitModule4);
    LOADPY(PyModule_New);
    LOADPY(PyModule_GetDict);
    LOADPY(PyModule_GetName);
    LOADPY(PyModule_GetFilename);
    LOADPY(_PyModule_Clear);
    LOADPY(PyType_IsSubtype);
    LOADPY(PyType_Ready);
    LOADPY(PyType_GenericAlloc);
    LOADPY(PyType_GenericNew);
    LOADPY(_PyType_Lookup);
    LOADPY(_PyObject_LookupSpecial);
    LOADPY(PyType_Modified);
    LOADPY(PyObject_Print);
    LOADPY(_PyObject_Dump);
    LOADPY(PyObject_Repr);
    LOADPY(_PyObject_Str);
    LOADPY(PyObject_Str);
    LOADPY(PyObject_Unicode);
    LOADPY(PyObject_Compare);
    LOADPY(PyObject_RichCompare);
    LOADPY(PyObject_RichCompareBool);
    LOADPY(PyObject_GetAttrString);
    LOADPY(PyObject_SetAttrString);
    LOADPY(PyObject_HasAttrString);
    LOADPY(PyObject_GetAttr);
    LOADPY(PyObject_SetAttr);
    LOADPY(PyObject_HasAttr);
    LOADPY(_PyObject_GetDictPtr);
    LOADPY(PyObject_SelfIter);
    LOADPY(_PyObject_NextNotImplemented);
    LOADPY(PyObject_GenericGetAttr);
    LOADPY(PyObject_GenericSetAttr);
    LOADPY(PyObject_Hash);
    LOADPY(PyObject_HashNotImplemented);
    LOADPY(PyObject_IsTrue);
    LOADPY(PyObject_Not);
    LOADPY(PyCallable_Check);
    LOADPY(PyNumber_Coerce);
    LOADPY(PyNumber_CoerceEx);
    LOADPY(PyObject_ClearWeakRefs);
    LOADPY(PyObject_Dir);
    LOADPY(Py_ReprEnter);
    LOADPY(Py_ReprLeave);
    LOADPY(_Py_HashDouble);
    LOADPY(_Py_HashPointer);
    LOADPY(_Py_NegativeRefcount);
    LOADPY(_PyDict_Dummy);
    LOADPY(_PySet_Dummy);
    LOADPY(_Py_GetRefTotal);
    LOADPY(inc_count);
    LOADPY(dec_count);
    LOADPY(_Py_NewReference);
    LOADPY(_Py_ForgetReference);
    LOADPY(_Py_Dealloc);
    LOADPY(_Py_PrintReferences);
    LOADPY(_Py_PrintReferenceAddresses);
    LOADPY(_Py_AddToAllObjects);
    LOADPY(Py_IncRef);
    LOADPY(Py_DecRef);
    LOADPY(_PyTrash_deposit_object);
    LOADPY(_PyTrash_destroy_chain);
    LOADPY(_PyTrash_thread_deposit_object);
    LOADPY(_PyTrash_thread_destroy_chain);
    LOADPY(PyObject_Malloc);
    LOADPY(PyObject_Realloc);
    LOADPY(PyObject_Free);
    LOADPY(_PyObject_DebugMalloc);
    LOADPY(_PyObject_DebugRealloc);
    LOADPY(_PyObject_DebugFree);
    LOADPY(_PyObject_DebugDumpAddress);
    LOADPY(_PyObject_DebugCheckAddress);
    LOADPY(_PyObject_DebugMallocStats);
    LOADPY(_PyObject_DebugMallocApi);
    LOADPY(_PyObject_DebugReallocApi);
    LOADPY(_PyObject_DebugFreeApi);
    LOADPY(_PyObject_DebugCheckAddressApi);
    LOADPY(_PyMem_DebugMalloc);
    LOADPY(_PyMem_DebugRealloc);
    LOADPY(_PyMem_DebugFree);
    LOADPY(PyObject_Init);
    LOADPY(PyObject_InitVar);
    LOADPY(_PyObject_New);
    LOADPY(_PyObject_NewVar);
    LOADPY(PyGC_Collect);
    LOADPY(_PyObject_GC_Resize);
    LOADPY(_PyObject_GC_Malloc);
    LOADPY(_PyObject_GC_New);
    LOADPY(_PyObject_GC_NewVar);
    LOADPY(PyObject_GC_Track);
    LOADPY(PyObject_GC_UnTrack);
    LOADPY(PyObject_GC_Del);
    LOADPY(PyObject_GC_Collectable);
    LOADPY(PySys_WriteStdout);
    LOADPY(PySys_WriteStderr);
    LOADPY(PyArena_New);
    LOADPY(PyArena_Free);
    LOADPY(PyArena_Malloc);
    LOADPY(PyArena_AddPyObject);
    LOADPY(PyCapsule_New);
    LOADPY(PyCapsule_GetPointer);
    LOADPY(PyCapsule_GetDestructor);
    LOADPY(PyCapsule_GetContext);
    LOADPY(PyCapsule_IsValid);
    LOADPY(PyCapsule_SetPointer);
    LOADPY(PyCapsule_SetDestructor);
    LOADPY(PyCapsule_SetName);
    LOADPY(PyCapsule_SetContext);
    LOADPY(PyCapsule_Import);
    LOADPY(Py_FatalError);
    LOADPY(PyErr_SetNone);
    LOADPY(PyErr_SetObject);
    LOADPY(PyErr_SetString);
    LOADPY(PyErr_Occurred);
    LOADPY(PyErr_Clear);
    LOADPY(PyErr_Fetch);
    LOADPY(PyErr_Restore);
    LOADPY(PyErr_GivenExceptionMatches);
    LOADPY(PyErr_ExceptionMatches);
    LOADPY(PyErr_NormalizeException);
    LOADPY(_PyErr_ReplaceException);
    LOADPY(PyErr_BadArgument);
    LOADPY(PyErr_NoMemory);
    LOADPY(PyErr_SetFromErrno);
    LOADPY(PyErr_SetFromErrnoWithFilenameObject);
    LOADPY(PyErr_SetFromErrnoWithFilename);
    LOADPY(PyErr_SetFromErrnoWithUnicodeFilename);
    LOADPY(PyErr_Format);
    LOADPY(PyErr_SetFromWindowsErrWithFilenameObject);
    LOADPY(PyErr_SetFromWindowsErrWithFilename);
    LOADPY(PyErr_SetFromWindowsErrWithUnicodeFilename);
    LOADPY(PyErr_SetFromWindowsErr);
    LOADPY(PyErr_SetExcFromWindowsErrWithFilenameObject);
    LOADPY(PyErr_SetExcFromWindowsErrWithFilename);
    LOADPY(PyErr_SetExcFromWindowsErrWithUnicodeFilename);
    LOADPY(PyErr_SetExcFromWindowsErr);
    LOADPY(PyErr_BadInternalCall);
    LOADPY(_PyErr_BadInternalCall);
    LOADPY(PyErr_NewException);
    LOADPY(PyErr_NewExceptionWithDoc);
    LOADPY(PyErr_WriteUnraisable);
    LOADPY(PyErr_CheckSignals);
    LOADPY(PyErr_SetInterrupt);
    LOADPY(PyErr_SyntaxLocation);
    LOADPY(PyErr_ProgramText);
    LOADPY(PyUnicodeDecodeError_Create);
    LOADPY(PyUnicodeEncodeError_Create);
    LOADPY(PyUnicodeTranslateError_Create);
    LOADPY(PyUnicodeEncodeError_GetEncoding);
    LOADPY(PyUnicodeDecodeError_GetEncoding);
    LOADPY(PyUnicodeEncodeError_GetObject);
    LOADPY(PyUnicodeDecodeError_GetObject);
    LOADPY(PyUnicodeTranslateError_GetObject);
    LOADPY(PyUnicodeEncodeError_GetStart);
    LOADPY(PyUnicodeDecodeError_GetStart);
    LOADPY(PyUnicodeTranslateError_GetStart);
    LOADPY(PyUnicodeEncodeError_SetStart);
    LOADPY(PyUnicodeDecodeError_SetStart);
    LOADPY(PyUnicodeTranslateError_SetStart);
    LOADPY(PyUnicodeEncodeError_GetEnd);
    LOADPY(PyUnicodeDecodeError_GetEnd);
    LOADPY(PyUnicodeTranslateError_GetEnd);
    LOADPY(PyUnicodeEncodeError_SetEnd);
    LOADPY(PyUnicodeDecodeError_SetEnd);
    LOADPY(PyUnicodeTranslateError_SetEnd);
    LOADPY(PyUnicodeEncodeError_GetReason);
    LOADPY(PyUnicodeDecodeError_GetReason);
    LOADPY(PyUnicodeTranslateError_GetReason);
    LOADPY(PyUnicodeEncodeError_SetReason);
    LOADPY(PyUnicodeDecodeError_SetReason);
    LOADPY(PyUnicodeTranslateError_SetReason);
    LOADPY(PyOS_snprintf);
    LOADPY(PyOS_vsnprintf);
    LOADPY(_PyOS_ResetGetOpt);
    LOADPY(_PyOS_GetOpt);
    LOADPY(_Py_force_double);
    LOADPY(_Py_set_387controlword);
    LOADPY(PyMem_Malloc);
    LOADPY(PyMem_Realloc);
    LOADPY(PyMem_Free);
    LOADPY(PyInterpreterState_New);
    LOADPY(PyInterpreterState_Clear);
    LOADPY(PyInterpreterState_Delete);
    LOADPY(PyThreadState_New);
    LOADPY(_PyThreadState_Prealloc);
    LOADPY(_PyThreadState_Init);
    LOADPY(PyThreadState_Clear);
    LOADPY(PyThreadState_Delete);
    LOADPY(PyThreadState_DeleteCurrent);
    LOADPY(PyThreadState_Get);
    LOADPY(PyThreadState_Swap);
    LOADPY(PyThreadState_GetDict);
    LOADPY(PyThreadState_SetAsyncExc);
    LOADPY(PyGILState_Ensure);
    LOADPY(PyGILState_Release);
    LOADPY(PyGILState_GetThisThreadState);
    LOADPY(_PyThread_CurrentFrames);
    LOADPY(PyInterpreterState_Head);
    LOADPY(PyInterpreterState_Next);
    LOADPY(PyInterpreterState_ThreadHead);
    LOADPY(PyThreadState_Next);
    LOADPY(PyOS_mystrnicmp);
    LOADPY(PyOS_mystricmp);
    LOADPY(PyOS_ascii_strtod);
    LOADPY(PyOS_ascii_atof);
    LOADPY(PyOS_ascii_formatd);
    LOADPY(PyOS_string_to_double);
    LOADPY(PyOS_double_to_string);
    LOADPY(_Py_parse_inf_or_nan);
    LOADPY(_Py_Mangle);
    LOADPY(Py_SetProgramName);
    LOADPY(Py_GetProgramName);
    LOADPY(Py_SetPythonHome);
    LOADPY(Py_GetPythonHome);
    LOADPY(Py_Initialize);
    LOADPY(Py_InitializeEx);
    LOADPY(Py_Finalize);
    LOADPY(Py_IsInitialized);
    LOADPY(Py_NewInterpreter);
    LOADPY(Py_EndInterpreter);
    LOADPY(PyRun_AnyFileFlags);
    LOADPY(PyRun_AnyFileExFlags);
    LOADPY(PyRun_SimpleStringFlags);
    LOADPY(PyRun_SimpleFileExFlags);
    LOADPY(PyRun_InteractiveOneFlags);
    LOADPY(PyRun_InteractiveLoopFlags);
    LOADPY(PyErr_Print);
    LOADPY(PyErr_PrintEx);
    LOADPY(PyErr_Display);
    LOADPY(Py_AtExit);
    LOADPY(Py_Exit);
    LOADPY(Py_FdIsInteractive);
    LOADPY(Py_Main);
    LOADPY(Py_GetProgramFullPath);
    LOADPY(Py_GetPrefix);
    LOADPY(Py_GetExecPrefix);
    LOADPY(Py_GetPath);
    LOADPY(_PyBuiltin_Init);
    LOADPY(_PySys_Init);
    LOADPY(_PyImport_Init);
    LOADPY(_PyExc_Init);
    LOADPY(_PyImportHooks_Init);
    LOADPY(_PyFrame_Init);
    LOADPY(_PyInt_Init);
    LOADPY(_PyLong_Init);
    LOADPY(_PyFloat_Init);
    LOADPY(PyByteArray_Init);
    LOADPY(_PyRandom_Init);
    LOADPY(_PyExc_Fini);
    LOADPY(_PyImport_Fini);
    LOADPY(PyMethod_Fini);
    LOADPY(PyFrame_Fini);
    LOADPY(PyCFunction_Fini);
    LOADPY(PyDict_Fini);
    LOADPY(PyTuple_Fini);
    LOADPY(PyList_Fini);
    LOADPY(PySet_Fini);
    LOADPY(PyString_Fini);
    LOADPY(PyInt_Fini);
    LOADPY(PyFloat_Fini);
    LOADPY(PyOS_FiniInterrupts);
    LOADPY(PyByteArray_Fini);
    LOADPY(_PyRandom_Fini);
    LOADPY(PyOS_Readline);
    LOADPY(PyOS_CheckStack);
    LOADPY(PyOS_getsig);
    LOADPY(PyOS_setsig);
    LOADPY(_PyOS_URandom);
    LOADPY(PySet_New);
    LOADPY(PyFrozenSet_New);
    LOADPY(PySet_Size);
    LOADPY(PySet_Clear);
    LOADPY(PySet_Contains);
    LOADPY(PySet_Discard);
    LOADPY(PySet_Add);
    LOADPY(_PySet_Next);
    LOADPY(_PySet_NextEntry);
    LOADPY(PySet_Pop);
    LOADPY(_PySet_Update);
    LOADPY(PySlice_New);
    LOADPY(_PySlice_FromIndices);
    LOADPY(PySlice_GetIndices);
    LOADPY(PyString_FromStringAndSize);
    LOADPY(PyString_FromString);
    LOADPY(PyString_FromFormatV);
    LOADPY(PyString_FromFormat);
    LOADPY(PyString_Size);
    LOADPY(PyString_AsString);
    LOADPY(PyString_Repr);
    LOADPY(PyString_Concat);
    LOADPY(PyString_ConcatAndDel);
    LOADPY(_PyString_Resize);
    LOADPY(_PyString_Eq);
    LOADPY(PyString_Format);
    LOADPY(_PyString_FormatLong);
    LOADPY(PyString_InternInPlace);
    LOADPY(PyString_InternImmortal);
    LOADPY(PyString_InternFromString);
    LOADPY(_Py_ReleaseInternedStrings);
    LOADPY(_PyString_Join);
    LOADPY(PyString_AsStringAndSize);
    LOADPY(_PyString_InsertThousandsGroupingLocale);
    LOADPY(_PyString_InsertThousandsGrouping);
    LOADPY(_PyBytes_FormatAdvanced);
    LOADPY(PyMember_Get);
    LOADPY(PyMember_Set);
    LOADPY(PyMember_GetOne);
    LOADPY(PyMember_SetOne);
    LOADPY(PySys_GetObject);
    LOADPY(PySys_SetObject);
    LOADPY(PySys_GetFile);
    LOADPY(PySys_SetArgv);
    LOADPY(PySys_SetArgvEx);
    LOADPY(PySys_SetPath);
    LOADPY(PySys_WriteStdout);
    LOADPY(PySys_WriteStderr);
    LOADPY(PySys_ResetWarnOptions);
    LOADPY(PySys_AddWarnOption);
    LOADPY(PySys_HasWarnOptions);
    LOADPY(_PySys_GetSizeOf);
    LOADPY(_PyTime_DoubleToTimet);
    LOADPY(_PyTime_FloatTime);
    LOADPY(PyToken_OneChar);
    LOADPY(PyToken_TwoChars);
    LOADPY(PyToken_ThreeChars);
    LOADPY(PyTraceBack_Here);
    LOADPY(PyTraceBack_Print);
    LOADPY(_Py_DisplaySourceLine);
    LOADPY(PyTuple_New);
    LOADPY(PyTuple_Size);
    LOADPY(PyTuple_GetItem);
    LOADPY(PyTuple_SetItem);
    LOADPY(PyTuple_GetSlice);
    LOADPY(_PyTuple_Resize);
    LOADPY(PyTuple_Pack);
    LOADPY(_PyTuple_MaybeUntrack);
    LOADPY(PyTuple_ClearFreeList);
    LOADPY(_PyWarnings_Init);
    LOADPY(PyErr_WarnEx);
    LOADPY(PyErr_WarnExplicit);
    LOADPY(PyWeakref_NewRef);
    LOADPY(PyWeakref_NewProxy);
    LOADPY(PyWeakref_GetObject);
    LOADPY(_PyWeakref_GetWeakrefCount);
    LOADPY(_PyWeakref_ClearRef);
    LOADPY(PyTasklet_New);
    LOADPY(PyTasklet_Setup);
    LOADPY(PyTasklet_BindEx);
    LOADPY(PyTasklet_BindThread);
    LOADPY(PyTasklet_Run);
    LOADPY(PyTasklet_Run_nr);
    LOADPY(PyTasklet_Switch);
    LOADPY(PyTasklet_Switch_nr);
    LOADPY(PyTasklet_Remove);
    LOADPY(PyTasklet_Insert);
    LOADPY(PyTasklet_RaiseException);
    LOADPY(PyTasklet_Throw);
    LOADPY(PyTasklet_Kill);
    LOADPY(PyTasklet_KillEx);
    LOADPY(PyTasklet_SetAtomic);
    LOADPY(PyTasklet_SetIgnoreNesting);
    LOADPY(PyTasklet_GetAtomic);
    LOADPY(PyTasklet_GetIgnoreNesting);
    LOADPY(PyTasklet_GetFrame);
    LOADPY(PyTasklet_GetBlockTrap);
    LOADPY(PyTasklet_SetBlockTrap);
    LOADPY(PyTasklet_IsMain);
    LOADPY(PyTasklet_IsCurrent);
    LOADPY(PyTasklet_GetRecursionDepth);
    LOADPY(PyTasklet_GetNestingLevel);
    LOADPY(PyTasklet_Alive);
    LOADPY(PyTasklet_Paused);
    LOADPY(PyTasklet_Scheduled);
    LOADPY(PyTasklet_Restorable);
    LOADPY(PyChannel_New);
    LOADPY(PyChannel_Send);
    LOADPY(PyChannel_Send_nr);
    LOADPY(PyChannel_Receive);
    LOADPY(PyChannel_Receive_nr);
    LOADPY(PyChannel_SendException);
    LOADPY(PyChannel_SendThrow);
    LOADPY(PyChannel_GetQueue);
    LOADPY(PyChannel_Close);
    LOADPY(PyChannel_Open);
    LOADPY(PyChannel_GetClosing);
    LOADPY(PyChannel_GetClosed);
    LOADPY(PyChannel_GetPreference);
    LOADPY(PyChannel_SetPreference);
    LOADPY(PyChannel_GetScheduleAll);
    LOADPY(PyChannel_SetScheduleAll);
    LOADPY(PyChannel_GetBalance);
    LOADPY(PyStackless_Schedule);
    LOADPY(PyStackless_Schedule_nr);
    LOADPY(PyStackless_GetRunCount);
    LOADPY(PyStackless_GetCurrent);
    LOADPY(PyStackless_GetCurrentId);
    LOADPY(PyStackless_RunWatchdog);
    LOADPY(PyStackless_RunWatchdogEx);
    LOADPY(PyStackless_SetChannelCallback);
    LOADPY(PyStackless_SetScheduleCallback);
    LOADPY(PyStackless_SetScheduleFastcallback);
    LOADPY(PyStackless_Call_Main);
    LOADPY(PyStackless_CallMethod_Main);
    LOADPY(PyStackless_CallCMethod_Main);
    LOADPY(_PyStackless_InitTypes);
    LOADPY(_PyStackless_Init);
    LOADPY(PyEval_EvalFrameEx_slp);
}
